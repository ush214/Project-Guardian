<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project Guardian: AI Wreck Assessment Agent</title>

  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles.css" />
  <script src="theme.js" defer></script>

  <style>
    #map { width: 100%; height: 500px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #e5e7eb; padding: 8px 10px; text-align: left; }
    th { background: #f9fafb; font-weight: 600; }
    .wreck-list-item.active { background: #e0f2fe !important; }
    .badge { font-size: 12px; border: 1px solid #e5e7eb; padding: 0.15rem 0.5rem; border-radius: 999px; color: #374151; background: #f9fafb; }
  </style>
</head>
<body class="text-gray-800" style="font-family: 'Inter', sans-serif;">
  <!-- Header -->
  <header class="bg-white shadow-md">
    <div class="container mx-auto px-4 md:px-8 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <img src="https://raw.githubusercontent.com/ush214/Logos/main/Screenshot%202025-09-02%20114624.jpg?raw=true" alt="Marinas Guardian Logo" class="h-16" />
        <img src="https://raw.githubusercontent.com/ush214/Logos/main/DeepTrek.jpg?raw=true" alt="Deeptrek Logo" class="h-16" />
      </div>
      <div class="flex items-center gap-3">
        <h1 class="hidden md:block text-2xl font-bold text-gray-700">Project Guardian AI Wreck Assessment Agent</h1>

        <button
          id="themeToggle"
          class="ml-4 rounded-md border border-gray-300 px-3 py-2 text-sm hover:bg-gray-50"
          onclick="toggleTheme()"
          aria-label="Toggle theme"
          title="Toggle theme"
        >ðŸŒ™</button>

        <!-- Signed-in info in header -->
        <div id="userInfo" class="hidden items-center gap-3 ml-4">
          <span id="roleBadge" class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700 border border-gray-300">Role: â€”</span>

          <!-- Admin Tools button (admin-only) -->
          <a id="adminToolsBtn"
             href="/admin-tools.html"
             class="hidden text-xs px-3 py-2 rounded bg-indigo-600 text-white hover:bg-indigo-700"
             title="Open Admin Tools">Admin Tools</a>

          <div class="text-sm text-gray-700">
            <div id="userName" class="font-medium"></div>
            <div id="userEmail" class="text-gray-500"></div>
          </div>
          <button id="signOutBtn" class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300">
            Sign out
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="container mx-auto p-4 md:p-8">
    <!-- ... existing content (auth, map, lists, report, scripts) ... -->
  </main>

  <script type="module">
    // NOTE: This block shows just the additions relevant to the Admin Tools button visibility.
    // Keep the rest of your existing index.html script content intact.

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore, doc, onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCiqs5iMg-Nj3r6yRszUxFKOIxmMfs5m6Q",
      authDomain: "project-guardian-agent.firebaseapp.com",
      projectId: "project-guardian-agent",
      storageBucket: "project-guardian-agent.firebasestorage.app",
      messagingSenderId: "84395007243",
      appId: "1:84395007243:web:b07e5f4c4264d27611160e",
      measurementId: "G-NRLH3WSCQ9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const adminToolsBtn = document.getElementById('adminToolsBtn');
    const userInfo = document.getElementById('userInfo');
    const roleBadge = document.getElementById('roleBadge');

    let roleUnsub = null;
    function showSignedOutUI() {
      userInfo.classList.add('hidden');
      adminToolsBtn.classList.add('hidden');
    }
    function updateRoleUI(currentRole) {
      const roleText = currentRole.charAt(0).toUpperCase() + currentRole.slice(1);
      roleBadge.textContent = `Role: ${roleText}`;
      // Show Admin Tools link only for admin
      adminToolsBtn.classList.toggle('hidden', currentRole !== 'admin');
    }

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        if (roleUnsub) { roleUnsub(); roleUnsub = null; }
        showSignedOutUI();
        return;
      }
      userInfo.classList.remove('hidden');

      // Subscribe to role
      if (roleUnsub) { roleUnsub(); roleUnsub = null; }
      const roleDocRef = doc(db, 'system', 'allowlist', 'users', user.uid);
      roleUnsub = onSnapshot(roleDocRef, (snap) => {
        const role = (snap.exists() && typeof snap.data().Role === 'string') ? snap.data().Role : 'user';
        updateRoleUI(role);
      }, () => updateRoleUI('user'));
    });
  </script>
</body>
</html>